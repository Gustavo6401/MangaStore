@model CheckoutViewModel

@{
    ViewData["Title"] = "Checkout";
}

<h1>Checkout</h1>

<h2>Itens do Carrinho</h2>

<section>
    @if(Model.Carrinho.Itens.Count > 0)
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Quantidade</th>
                    <th></th>
                    <th>Preço</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Carrinho.Itens)
                {
                    <tr>
                        <td>@item.NomeProduto</td>
                        <td>@item.Qtd</td>
                        <td>
                            <a class="btn btn-success btn-sm" asp-action="Add" asp-controller="Carrinho" asp-route-id=@item.ProdutoId>+</a>
                            <a class="btn btn-primary btn-sm" asp-action="Decrease" asp-controller="Carrinho" asp-route-id=@item.ProdutoId>-</a>
                            <a class="btn btn-danger btn-sm" asp-action="Remove" asp-controller="Carrinho" asp-route-id=@item.ProdutoId>Remover</a>
                        </td>
                        <td>@item.Preco.ToString("C2")</td>
                        <td>@Model.Carrinho.Itens.Where(x => x.ProdutoId == item.ProdutoId).Sum(x => x.Qtd * x.Preco).ToString("C2")</td>
                    </tr>
            }
            <tr>
                <td class="text-right" colespan="4">Total: @Model.Carrinho.Total.ToString("C2")</td>
            </tr>
        </tbody>
    </table>
}
</section>

<section>
    @if(Model.ListaEnderecos.Count > 0) 
    {
        <table class="table">
            <thead>
                <tr>
                    <th></th>
                    <th>CEP</th>
                    <th>Rua</th>
                    <th>Bairro</th>
                    <th>Cidade</th>
                    <th>UF</th>
                    <th>Número</th>
                    <th>Endereço Padrão?</th>
                </tr>
            </thead>
            <tbody>
                @foreach(var item in Model.ListaEnderecos)
                {
                    <tr>
                        <td>
                            Selecionado?
                            <form asp-action=SelecionarEndereco>
                                <input name="selecionado" class="form-check-input" onclick="SelecionarEndereco()" id="check" type="checkbox" />
                                <input asp-for="@(item.CEP)" name="cep" readonly type=hidden>
                                <input class="d-none" type="number" asp-for=Carrinho.Total name="total">
                            </form>
                        </td>
                        <td>
                            <input asp-for="@(item.CEP)" name="cep" readonly>
                            @*Eu coloquei esse input para ele ser passado junto com a seleção do endereço.*@
                            <input class="d-none" type="number" asp-for=Carrinho.Total name="total">
                        </td>
                        <td>
                            @Html.DisplayFor(model => item.Rua)
                        </td>
                        <td>
                            @Html.DisplayFor(model => item.Bairro)
                        </td>
                        <td>
                            @Html.DisplayFor(model => item.Cidade)
                        </td>
                        <td>
                            @Html.DisplayFor(model => item.UF)
                        </td>
                        <td>
                            @Html.DisplayFor(model => item.Numero)
                        </td>
                        <td>
                            @Html.CheckBoxFor(model => item.EnderecoPadrao)
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</section>
<section>
    <h5>Total: @Model.Carrinho.Total.ToString("C2")</h5>
    <h5>Frete: @Model.Carrinho.Frete.ToString("C2")</h5>
    <h2>Total: @Model.Total.ToString("C2")</h2>
</section>
<section>
    <form asp-action="Pagar">
        <div>
            <div class="form-group">
                <label asp-for="NomeCompleto" class="control-label">Nome no Cartão</label>
                <input asp-for="NomeCompleto" class="form-control" />
                <span asp-validation-for="NomeCompleto" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Cartao" class="control-label">Nº Cartão</label>
                <input asp-for="Cartao" class="form-control" />
                <span asp-validation-for="Cartao" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="DigitoVerificador" class="control-label">Digito Verificador</label>
                <input asp-for="DigitoVerificador" class="form-control" />
                <span asp-validation-for="DigitoVerificador" class="text-danger"></span>
            </div>
        </div>
        <div>
            <a class="btn btn-success">Gerar Boleto</a>
        </div>
    </form>
</section>

@section Scripts {
    <script language="JavaScript" type="text/javascript">
        $(function () {
            $("#check").change(function() {
                $(this).closest('form').submit();
            })
        })
    </script>
}